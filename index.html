<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript & API's</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Open Sans', sans-serif; }
        
        /* Loading Animation Dots */
        .loading::after {
            content: ' .';
            animation: dots 1.5s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: ' .'; }
            40% { content: ' ..'; }
            60% { content: ' ...'; }
            80%, 100% { content: ''; }
        }

        /* Diagram connectors */
        .arrow-right {
            position: relative;
            height: 2px;
            background-color: #94a3b8;
            width: 100%;
            margin: 0 10px;
        }
        .arrow-right::after {
            content: '';
            position: absolute;
            right: 0;
            top: -4px;
            width: 0; 
            height: 0; 
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
            border-left: 8px solid #94a3b8;
        }
        .double-arrow {
            position: relative;
            height: 2px;
            background-color: #94a3b8;
            width: 40px;
        }
        .double-arrow::before {
            content: '';
            position: absolute;
            left: 0;
            top: -4px;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
            border-right: 8px solid #94a3b8;
        }
        .double-arrow::after {
            content: '';
            position: absolute;
            right: 0;
            top: -4px;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
            border-left: 8px solid #94a3b8;
        }
    </style>
</head>
<body class="bg-white text-slate-900">

    <!-- Header Section (Yellow Background) -->
    <header class="bg-[#F7DF1E] w-full py-8 px-4 shadow-sm">
        <div class="max-w-3xl mx-auto flex justify-between items-center">
            <!-- Left Icon: Computer Code -->
            <div class="text-slate-800">
                <i class="fas fa-laptop-code text-6xl sm:text-8xl"></i>
            </div>
            
            <!-- Title Text (Hidden on very small screens for better fit) -->
            <div class="text-center mx-4 hidden sm:block">
                 <h1 class="text-4xl sm:text-6xl font-bold text-slate-900 tracking-tight">JavaScript</h1>
            </div>

            <!-- Right Icon: JS Badge -->
            <div class="bg-white rounded-lg shadow-lg overflow-hidden w-20 h-20 sm:w-24 sm:h-24 flex items-center justify-center">
                <i class="fab fa-js text-[#F7DF1E] text-6xl sm:text-7xl bg-black w-full h-full flex items-center justify-center"></i>
            </div>
        </div>
        <!-- Mobile Title fallback -->
        <div class="text-center mt-4 sm:hidden">
            <h1 class="text-5xl font-bold text-slate-900 tracking-tight">JavaScript</h1>
       </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-3xl mx-auto px-6 py-10 space-y-10">

        <!-- Intro -->
        <div>
            <h1 class="text-4xl font-bold text-slate-800 mb-2">JavaScript & API's</h1>
            <p class="text-slate-600 text-lg">
                With basic knowledge of JavaScript and API's I can find out that:
            </p>
            <button onclick="startSequence()" id="startBtn" class="mt-4 bg-slate-900 text-white px-6 py-2 rounded hover:bg-slate-700 transition-colors">
                Run Code
            </button>
            <div id="error-log" class="text-red-500 mt-2 text-sm font-mono hidden"></div>
        </div>

        <!-- Section 1: Location -->
        <div class="space-y-1">
            <h2 class="text-3xl font-bold text-slate-800">You are from:</h2>
            <div id="location-result" class="text-xl text-slate-600 pl-1 min-h-[3.5rem]">
                <span class="text-slate-300">...</span>
            </div>
        </div>

        <!-- Section 2: Weather -->
        <div class="space-y-1">
            <h2 class="text-3xl font-bold text-slate-800">The weather there is:</h2>
            <div id="weather-result" class="text-xl text-slate-600 pl-1 min-h-[2rem]">
                <span class="text-slate-300">...</span>
            </div>
        </div>

        <!-- Section 3: ISP -->
        <div class="space-y-1">
            <h2 class="text-3xl font-bold text-slate-800">Your Internet Service Provider is:</h2>
            <div id="isp-result" class="text-xl text-slate-600 pl-1 min-h-[2rem]">
                <span class="text-slate-300">...</span>
            </div>
        </div>

        <!-- Bottom Diagram: CSS Re-creation of the image diagram -->
        <div class="pt-10 border-t border-slate-200 mt-12">
            <div class="flex flex-col md:flex-row items-center justify-between gap-8 text-center text-xs font-bold text-slate-600 uppercase tracking-wider">
                
                <!-- Left: Application/DB -->
                <div class="flex flex-col items-center gap-2 p-4 bg-slate-50 rounded-lg w-full md:w-1/3">
                    <div class="flex items-center gap-2 text-green-500 mb-2">
                        <i class="fas fa-calendar-check text-2xl"></i>
                        <span class="text-slate-500 normal-case">PlanningPME</span>
                    </div>
                    <i class="fas fa-database text-blue-500 text-6xl"></i>
                    <div class="mt-2">Database</div>
                    <div class="font-black text-slate-800 mt-1">APPLICATION</div>
                </div>

                <!-- Middle: Interface (API) -->
                <div class="flex flex-row md:flex-col items-center justify-center w-full md:w-1/4 gap-2">
                    <div class="flex flex-col items-center w-full">
                        <div class="double-arrow rotate-90 md:rotate-0 my-2"></div>
                        <div class="bg-blue-100 text-blue-800 px-3 py-12 rounded shadow-sm border border-blue-200 mx-2">
                            API
                        </div>
                        <div class="double-arrow rotate-90 md:rotate-0 my-2"></div>
                    </div>
                    <div class="mt-0 md:mt-2">INTERFACE</div>
                </div>

                <!-- Right: WebAccess -->
                <div class="flex flex-col items-center gap-2 p-4 bg-slate-50 rounded-lg w-full md:w-1/3">
                    <div class="flex gap-4 mb-2 text-blue-500">
                        <i class="fas fa-laptop text-5xl"></i>
                        <i class="fas fa-mobile-alt text-4xl mt-2"></i>
                    </div>
                    <div>WebAccess</div>
                    
                    <div class="my-4 rounded-full border-4 border-orange-400 p-4 w-20 h-20 flex items-center justify-center">
                        <i class="fas fa-code text-orange-400 text-2xl"></i>
                    </div>
                    <div>Any program</div>
                    <div class="font-black text-slate-800 mt-1">PROGRAMMING</div>
                </div>

            </div>
        </div>

    </main>

    <script>
        async function startSequence() {
            const btn = document.getElementById('startBtn');
            const locEl = document.getElementById('location-result');
            const weatherEl = document.getElementById('weather-result');
            const ispEl = document.getElementById('isp-result');
            const errEl = document.getElementById('error-log');

            // Reset UI
            btn.disabled = true;
            btn.innerText = "Processing...";
            locEl.innerHTML = '<span class="loading">Locating</span>';
            weatherEl.innerHTML = '<span class="loading">Checking forecast</span>';
            ispEl.innerHTML = '<span class="loading">Identifying ISP</span>';
            errEl.classList.add('hidden');
            errEl.innerText = '';

            try {
                // --- STEP 1: Get IP ---
                // We don't display this directly in the new UI, but we use it for the next steps
                const ipRes = await fetch('https://api.ipify.org?format=json');
                if (!ipRes.ok) throw new Error('IP Fetch Failed');
                const ipData = await ipRes.json();
                const ip = ipData.ip;
                console.log("Step 1 (IP):", ip);

                // --- STEP 2: Get Location & ISP (Using IP) ---
                const locRes = await fetch(`https://ipapi.co/${ip}/json/`);
                if (!locRes.ok) throw new Error('Location Fetch Failed');
                const locData = await locRes.json();
                console.log("Step 2 (Location):", locData);

                // Update UI for Location & ISP immediately
                locEl.innerHTML = `
                    <div class="text-slate-800">${locData.city}</div>
                    <div class="text-slate-500 text-lg">${locData.country_name}</div>
                `;
                ispEl.innerHTML = `<div class="text-slate-800">${locData.org}</div>`;

                // --- STEP 3: Get Weather (Using IP - Wttr.in) ---
                // We fetch this to satisfy the 4 API call requirement, but we might prioritize Open-Meteo for data
                // Note: wttr.in often returns plain text, we want JSON
                try {
                    const wttrRes = await fetch(`https://wttr.in/${ip}?format=j1`);
                    const wttrData = await wttrRes.json();
                    console.log("Step 3 (Wttr Weather):", wttrData);
                } catch(e) {
                    console.warn("Step 3 (Wttr) failed, continuing to Step 4...");
                }

                // --- STEP 4: Get Weather (Using Lat/Lon from Step 2) ---
                // This is often more reliable for specific condition codes
                const lat = locData.latitude;
                const lon = locData.longitude;
                const meteoRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
                if (!meteoRes.ok) throw new Error('Weather Fetch Failed');
                const meteoData = await meteoRes.json();
                console.log("Step 4 (Meteo Weather):", meteoData);

                // Interpret Weather Code (WMO code)
                const weatherCode = meteoData.current_weather.weathercode;
                const weatherDesc = getWeatherDescription(weatherCode);
                const temp = meteoData.current_weather.temperature;
                const weatherIcon = getWeatherIcon(weatherCode);

                // Determine conversational status about rain
                let rainStatus = "It is not raining.";
                const descLower = weatherDesc.toLowerCase();
                if (descLower.includes('rain') || descLower.includes('drizzle') || descLower.includes('thunderstorm')) {
                    rainStatus = "Yes, it is raining.";
                } else if (descLower.includes('snow')) {
                    rainStatus = "It is snowing.";
                } else if (descLower.includes('fog')) {
                    rainStatus = "It is foggy.";
                } else if (weatherCode === 0 || weatherCode === 1) {
                    rainStatus = "It is sunny/clear.";
                } else if (weatherCode === 2 || weatherCode === 3) {
                    rainStatus = "It is cloudy.";
                }

                // Update UI for Weather
                weatherEl.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="bg-blue-50 p-3 rounded-full">
                            <i class="fas ${weatherIcon} text-3xl text-blue-600"></i>
                        </div>
                        <div class="text-slate-800">
                            <div class="font-bold text-lg">${rainStatus}</div>
                            <div class="text-sm text-slate-500">Condition: ${weatherDesc} (${temp}Â°C)</div>
                        </div>
                    </div>
                `;

                btn.innerText = "Code Ran Successfully";
                btn.classList.remove('bg-slate-900', 'hover:bg-slate-700');
                btn.classList.add('bg-green-600', 'hover:bg-green-500');

            } catch (error) {
                console.error(error);
                errEl.innerText = "Error: " + error.message;
                errEl.classList.remove('hidden');
                btn.innerText = "Retry";
                btn.disabled = false;
            }
        }

        // Helper to convert WMO codes to text (like "light rain" in the image)
        function getWeatherDescription(code) {
            const codes = {
                0: 'Clear sky',
                1: 'Mainly clear', 2: 'Partly cloudy', 3: 'Overcast',
                45: 'Fog', 48: 'Depositing rime fog',
                51: 'Light drizzle', 53: 'Moderate drizzle', 55: 'Dense drizzle',
                61: 'Slight rain', 63: 'Moderate rain', 65: 'Heavy rain',
                71: 'Slight snow', 73: 'Moderate snow', 75: 'Heavy snow',
                95: 'Thunderstorm', 96: 'Thunderstorm with slight hail', 99: 'Thunderstorm with heavy hail'
            };
            return codes[code] || 'Unknown conditions';
        }

        // Helper to convert WMO codes to FontAwesome Icons
        function getWeatherIcon(code) {
            const icons = {
                0: 'fa-sun', // Clear
                1: 'fa-cloud-sun', 2: 'fa-cloud-sun', 3: 'fa-cloud', // Cloudy
                45: 'fa-smog', 48: 'fa-smog', // Fog
                51: 'fa-cloud-rain', 53: 'fa-cloud-rain', 55: 'fa-cloud-showers-heavy', // Drizzle
                61: 'fa-cloud-rain', 63: 'fa-cloud-showers-heavy', 65: 'fa-cloud-showers-heavy', // Rain
                71: 'fa-snowflake', 73: 'fa-snowflake', 75: 'fa-snowflake', // Snow
                95: 'fa-bolt', 96: 'fa-bolt', 99: 'fa-bolt' // Thunder
            };
            // Default to cloud if unknown
            return icons[code] || 'fa-cloud';
        }
    </script>
</body>
</html>